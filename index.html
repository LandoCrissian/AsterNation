<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Aster Nation | Nations Among the Stars</title>

  <script>document.documentElement.setAttribute('data-theme','dark');</script>

  <meta name="description" content="Aster Nation — Mint your Star Pass, join your constellation, and represent among the stars." />
  <meta name="theme-color" content="#0b0d12" />
  <link rel="icon" href="https://raw.githubusercontent.com/LandoCrissian/AsterNation/refs/heads/main/06459AB6-EE5C-444D-8584-914806849C80.png" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/examples/js/controls/OrbitControls.js"></script>

  <style>
    :root{
      --bg:#0b0d12; --text:#f5f5f5; --muted:#9ca3af;
      --line:#1f2937; --soft:#101320;
      --accent:#d4af37; --accent-600:#b8860b;
    }

    body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;}
    header{padding:12px 20px;border-bottom:1px solid var(--line);position:sticky;top:0;background:rgba(11,13,18,.9);backdrop-filter:blur(8px);z-index:50;display:flex;justify-content:space-between;align-items:center;}
    header img{width:32px;height:32px;border-radius:50%;}
    header b{margin-left:8px;color:var(--accent);}
    h1{text-align:center;font-size:clamp(28px,3vw,42px);color:var(--accent);margin:20px 0;}
    p.lead{text-align:center;color:var(--muted);margin-bottom:20px;}
    #galaxyCanvas{width:100%;height:100vh;display:block;}

    /* Drawer */
    #drawer{position:fixed;top:0;right:-400px;width:400px;max-width:100%;height:100%;background:var(--soft);box-shadow:-4px 0 12px rgba(0,0,0,0.6);transition:right .3s ease;z-index:100;padding:20px;display:flex;flex-direction:column;}
    #drawer.active{right:0;}
    #drawer h2{margin:0 0 10px;color:var(--accent);}
    #drawer p{color:var(--muted);}
    #drawer button{margin-top:auto;padding:12px;border:none;border-radius:8px;font-weight:700;cursor:pointer;background:var(--accent);color:#000;transition:.2s;}
    #drawer button:hover{background:var(--accent-600);color:#fff;}
    #drawerClose{position:absolute;top:10px;right:14px;font-size:20px;cursor:pointer;}

    @media(max-width:640px){#drawer{width:100%;}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;">
      <img src="https://raw.githubusercontent.com/LandoCrissian/AsterNation/refs/heads/main/06459AB6-EE5C-444D-8584-914806849C80.png" alt="Aster Nation"/>
      <b>Aster Nation</b>
    </div>
    <button id="connectBtn">Connect Wallet</button>
  </header>

  <canvas id="galaxyCanvas"></canvas>

  <!-- Drawer -->
  <div id="drawer">
    <span id="drawerClose">✖</span>
    <h2 id="drawerTitle">Constellation</h2>
    <p id="drawerDesc">Description goes here...</p>
    <p><b>Joined:</b> <span id="drawerCount">0</span> explorers</p>
    <button id="joinBtn">Join Constellation</button>
  </div>

  <script>
    const CONSTELLATIONS=[
      {name:"Orion",desc:"The hunter of the stars.",count:42,pos:{x:-150,y:50,z:-200}},
      {name:"Lyra",desc:"The harp that sings through galaxies.",count:31,pos:{x:200,y:-100,z:-300}},
      {name:"Nebula",desc:"The birthplace of new stars.",count:57,pos:{x:-50,y:-150,z:-100}},
    ];

    let scene,camera,renderer,controls,raycaster,mouse;
    let clusters=[],warpLines=[];let warpActive=false;let warpStart=0;

    function initGalaxy(){
      const canvas=document.getElementById("galaxyCanvas");
      scene=new THREE.Scene();
      const width=window.innerWidth,height=window.innerHeight;

      camera=new THREE.PerspectiveCamera(60,width/height,0.1,5000);
      camera.position.z=localStorage.getItem("hyperspacePlayed")?400:2000;

      renderer=new THREE.WebGLRenderer({canvas,antialias:true});
      renderer.setSize(width,height);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));

      controls=new THREE.OrbitControls(camera,renderer.domElement);
      controls.enableDamping=true;

      // Stars
      const starGeo=new THREE.BufferGeometry();
      const starCount=4000;const pos=[];
      for(let i=0;i<starCount;i++){pos.push((Math.random()-0.5)*4000,(Math.random()-0.5)*4000,(Math.random()-0.5)*4000);}
      starGeo.setAttribute("position",new THREE.Float32BufferAttribute(pos,3));
      scene.add(new THREE.Points(starGeo,new THREE.PointsMaterial({color:0xffffff,size:1})));

      // Clusters
      const glowMat=new THREE.MeshBasicMaterial({color:0xd4af37});
      const geom=new THREE.SphereGeometry(12,32,32);
      CONSTELLATIONS.forEach(c=>{
        const sphere=new THREE.Mesh(geom,glowMat.clone());
        sphere.position.set(c.pos.x,c.pos.y,c.pos.z);sphere.userData=c;
        scene.add(sphere);clusters.push(sphere);

        // Label
        const canvasLabel=document.createElement("canvas");
        canvasLabel.width=256;canvasLabel.height=64;
        const ctx=canvasLabel.getContext("2d");
        ctx.font="28px Inter";ctx.fillStyle="#d4af37";ctx.fillText(c.name,10,40);
        const tex=new THREE.CanvasTexture(canvasLabel);
        const sprite=new THREE.Sprite(new THREE.SpriteMaterial({map:tex,transparent:true}));
        sprite.position.set(c.pos.x,c.pos.y+25,c.pos.z);sprite.scale.set(100,40,1);
        scene.add(sprite);
      });

      raycaster=new THREE.Raycaster();mouse=new THREE.Vector2();
      canvas.addEventListener("click",onClickCluster);
      window.addEventListener("resize",onResize);

      // Hyperspace effect
      if(!localStorage.getItem("hyperspacePlayed")){
        warpActive=true;warpStart=performance.now();
        createWarpLines();
      }

      animate();
    }

    function createWarpLines(){
      const material=new THREE.LineBasicMaterial({color:0xffffff});
      for(let i=0;i<500;i++){
        const geometry=new THREE.BufferGeometry().setFromPoints([new THREE.Vector3((Math.random()-0.5)*2000,(Math.random()-0.5)*2000,(Math.random()-0.5)*2000),(Math.random()-0.5)*2000,(Math.random()-0.5)*2000,(Math.random()-0.5)*2000]);
        const line=new THREE.Line(geometry,material);
        scene.add(line);warpLines.push(line);
      }
    }

    function animate(t){
      requestAnimationFrame(animate);
      controls.update();

      if(warpActive){
        const elapsed=(t-warpStart)/2000; // 2s warp
        camera.position.z=2000-(1600*Math.min(elapsed,1));
        warpLines.forEach(l=>l.material.opacity=1-elapsed);
        if(elapsed>=1){
          warpActive=false;
          warpLines.forEach(l=>scene.remove(l));
          localStorage.setItem("hyperspacePlayed","true");
        }
      }

      renderer.render(scene,camera);
    }

    function onClickCluster(event){
      const rect=renderer.domElement.getBoundingClientRect();
      mouse.x=((event.clientX-rect.left)/rect.width)*2-1;
      mouse.y=-((event.clientY-rect.top)/rect.height)*2+1;
      raycaster.setFromCamera(mouse,camera);
      const hits=raycaster.intersectObjects(clusters);
      if(hits.length>0){openDrawer(hits[0].object.userData);}
    }

    function openDrawer(data){
      document.getElementById("drawerTitle").textContent=data.name;
      document.getElementById("drawerDesc").textContent=data.desc;
      document.getElementById("drawerCount").textContent=data.count;
      document.getElementById("drawer").classList.add("active");
      document.getElementById("joinBtn").onclick=()=>{data.count++;document.getElementById("drawerCount").textContent=data.count;};
    }

    function onResize(){
      camera.aspect=window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth,window.innerHeight);
    }

    document.getElementById("drawerClose").onclick=()=>{document.getElementById("drawer").classList.remove("active");};
    window.addEventListener("load",initGalaxy);
  </script>
</body>
</html>
